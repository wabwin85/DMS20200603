<?xml version="1.0" encoding="utf-8" ?>
<sqlMap namespace="ScoreCardLogMap" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://ibatis.apache.org/mapping">
  <alias>
    <typeAlias alias="ScoreCardLog" assembly="DMS.Model.dll" type="DMS.Model.ScoreCardLog" />
  </alias>
  <resultMaps>
    <resultMap id="ScoreCardLogResult" class="ScoreCardLog">
      <result property="Id" column="SCL_ID" type="Guid" dbType="uniqueidentifier"/>
      <result property="EscId" column="SCL_ESC_ID" type="Guid" dbType="uniqueidentifier"/>
      <result property="OperUser" column="SCL_OperUser" type="string" dbType="nvarchar"/>
      <result property="OperDate" column="SCL_OperDate" type="DateTime" dbType="datetime"/>
      <result property="OperType" column="SCL_OperType" type="string" dbType="nvarchar"/>
      <result property="OperNote" column="SCL_OperNote" type="string" dbType="nvarchar"/>
    </resultMap>
  </resultMaps>
  <statements>

    <select id="SelectScoreCardLog" parameterClass="string" resultClass="ScoreCardLog">
      SELECT SCL_ID AS Id,SCL_ESC_ID AS EscId,SCL_OperUser AS OperUser,SCL_OperDate AS OperDate,SCL_OperType AS OperType,SCL_OperNote AS OperNote
      FROM ScoreCardLog
      <dynamic prepend="WHERE">
        <isParameterPresent>
          SCL_ID = #value#
        </isParameterPresent>
      </dynamic>
    </select>
    <select id="SelectByFilterScoreCardLog" parameterClass="ScoreCardLog" resultClass="ScoreCardLog">
      SELECT SCL_ID AS Id,SCL_ESC_ID AS EscId,SCL_OperUser AS OperUser,SCL_OperDate AS OperDate,SCL_OperType AS OperType,SCL_OperNote AS OperNote
      FROM ScoreCardLog
      <dynamic prepend="WHERE">
        <isNotNull prepend="AND" property="Id">SCL_ID=#Id#</isNotNull>
        <isNotNull prepend="AND" property="EscId">SCL_ESC_ID=#EscId#</isNotNull>
        <isNotNull prepend="AND" property="OperUser">SCL_OperUser=#OperUser#</isNotNull>
        <isNotNull prepend="AND" property="OperDate">SCL_OperDate=#OperDate#</isNotNull>
        <isNotNull prepend="AND" property="OperType">SCL_OperType=#OperType#</isNotNull>
        <isNotNull prepend="AND" property="OperNote">SCL_OperNote=#OperNote#</isNotNull>
      </dynamic>
    </select>
    <insert id="InsertScoreCardLog" parameterClass="ScoreCardLog">
      INSERT INTO ScoreCardLog
      (SCL_ID,SCL_ESC_ID,SCL_OperUser,SCL_OperDate,SCL_OperType,SCL_OperNote)
      VALUES(#Id#,#EscId#,#OperUser#,#OperDate:DateTime:1/1/0001 12:00:00 AM#,#OperType#,#OperNote#)
    </insert>
    <update id="UpdateScoreCardLog" parameterClass="ScoreCardLog">
      UPDATE ScoreCardLog
      SET SCL_ID=#Id#,SCL_ESC_ID=#EscId#,SCL_OperUser=#OperUser#,SCL_OperDate=#OperDate#,SCL_OperType=#OperType#,SCL_OperNote=#OperNote#
      WHERE SCL_ID = #Id#
    </update>
    <delete id="DeleteScoreCardLog" parameterClass="string">
      DELETE FROM ScoreCardLog
      WHERE SCL_ID = #value#
    </delete>
    <select id="QueryScoreCardLogByFilter" parameterClass="ScoreCardLog" resultClass="ScoreCardLog">
      SELECT *,ROW_NUMBER() OVER (ORDER BY OperDate DESC) AS [row_number]
      FROM (
      SELECT
      ScoreCardLog.SCL_ID AS Id,
      ScoreCardLog.SCL_ESC_ID AS PohId,
      ScoreCardLog.SCL_OperUser AS OperUser,
      case when Lafite_IDENTITY.IDENTITY_NAME is null then SCL_OperUser else IDENTITY_NAME end AS OperUserName,
      ScoreCardLog.SCL_OperType AS OperType,
      ScoreCardLog.SCL_OperDate AS OperDate,
      ScoreCardLog.SCL_OperNote AS OperNote
      FROM    ScoreCardLog
      LEFT JOIN
      Lafite_IDENTITY
      ON ScoreCardLog.SCL_OperUser = Lafite_IDENTITY.IDENTITY_Code
      <dynamic prepend="WHERE">
        <isNotNull prepend="AND" property="Id">SCL_ID=#Id#</isNotNull>
        <isNotNull prepend="AND" property="EscId">SCL_ESC_ID=#EscId#</isNotNull>
        <isNotNull prepend="AND" property="OperUser">SCL_OperUser=#OperUser#</isNotNull>
        <isNotNull prepend="AND" property="OperDate">SCL_OperDate=#OperDate#</isNotNull>
        <isNotNull prepend="AND" property="OperType">SCL_OperType=#OperType#</isNotNull>
        <isNotNull prepend="AND" property="OperNote">SCL_OperNote=#OperNote#</isNotNull>
      </dynamic>
      ) TAB
      WHERE ISNULL(OperUserName,'') &lt;> ''
    </select>
  </statements>
</sqlMap>
