<?xml version="1.0" encoding="utf-8" ?>
<sqlMap namespace="ConsignmentTransferInitMap" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://ibatis.apache.org/mapping">
  <alias>
    <typeAlias alias="ConsignmentTransferInit" assembly="DMS.Model.dll" type="DMS.Model.ConsignmentTransferInit" />
  </alias>
  <resultMaps>
    <resultMap id="ConsignmentTransferInitResult" class="ConsignmentTransferInit">
      <result property="Id" column="ID" type="string" dbType="nvarchar"/>
      <result property="DealerCodeTo" column="DealerCodeTo" type="string" dbType="nvarchar"/>
      <result property="DealerIdTo" column="DealerIdTo" type="string" dbType="nvarchar"/>
      <result property="DealerCodeFrom" column="DealerCodeFrom" type="string" dbType="nvarchar"/>
      <result property="DealerIdFrom" column="DealerIdFrom" type="string" dbType="nvarchar"/>
      <result property="ProductLineName" column="ProductLineName" type="string" dbType="nvarchar"/>
      <result property="ProductLineId" column="ProductLineId" type="string" dbType="nvarchar"/>
      <result property="Upn" column="Upn" type="string" dbType="nvarchar"/>
      <result property="Qty" column="Qty" type="int" dbType="int"/>
      <result property="ContractNo" column="ContractNo" type="string" dbType="nvarchar"/>
      <result property="ContractId" column="ContractId" type="string" dbType="nvarchar"/>
      <result property="HospitalCode" column="HospitalCode" type="string" dbType="nvarchar"/>
      <result property="HospitalName" column="HospitalName" type="string" dbType="nvarchar"/>
      <result property="HospitalId" column="HospitalId" type="string" dbType="nvarchar"/>
      <result property="Remark" column="Remark" type="string" dbType="nvarchar"/>
      <result property="ErrFlg" column="ErrFlg" type="int" dbType="int"/>
      <result property="ErrMassages" column="ErrMassages" type="string" dbType="varchar"/>
      <result property="InputUser" column="InputUser" type="string" dbType="nvarchar"/>
      <result property="InputDate" column="InputDate" type="DateTime" dbType="datetime"/>
      <result property="LineNbr" column="LineNbr" type="int" dbType="int"/>
    </resultMap>
  </resultMaps>
  <parameterMaps>
    <parameterMap id="ConsignmentTransferInitParameterMap" class="System.Collections.Hashtable" >
      <parameter property="UserId" column="UserId" />
      <parameter property="ImportType" column="ImportType" />
      <parameter property="SubCompanyId" column="SubCompanyId" />
      <parameter property="BrandId" column="BrandId" />
      <parameter property="IsValid" column="IsValid" direction="Output" />
    </parameterMap>
  </parameterMaps>
  <statements>


    <select id="SelectConsignmentTransferInit" parameterClass="string" resultClass="ConsignmentTransferInit">
      SELECT ID AS Id,DealerCodeTo AS DealerCodeTo,DealerIdTo AS DealerIdTo,DealerCodeFrom AS DealerCodeFrom,DealerIdFrom AS DealerIdFrom,ProductLineName AS ProductLineName,ProductLineId AS ProductLineId,Upn AS Upn,Qty AS Qty,ContractNo AS ContractNo,ContractId AS ContractId,HospitalCode AS HospitalCode,HospitalName AS HospitalName,HospitalId AS HospitalId,Remark AS Remark,ErrFlg AS ErrFlg,ErrMassages AS ErrMassages,InputUser AS InputUser,InputDate AS InputDate,LineNbr AS LineNbr
      FROM ConsignmentTransferInit
      <dynamic prepend="WHERE">
        <isParameterPresent>
          ID = #value#
        </isParameterPresent>
      </dynamic>
    </select>
    <select id="SelectByFilterConsignmentTransferInit" parameterClass="ConsignmentTransferInit" resultClass="ConsignmentTransferInit">
      SELECT ID AS Id,DealerCodeTo AS DealerCodeTo,DealerIdTo AS DealerIdTo,DealerCodeFrom AS DealerCodeFrom,DealerIdFrom AS DealerIdFrom,ProductLineName AS ProductLineName,ProductLineId AS ProductLineId,Upn AS Upn,Qty AS Qty,ContractNo AS ContractNo,ContractId AS ContractId,HospitalCode AS HospitalCode,HospitalName AS HospitalName,HospitalId AS HospitalId,Remark AS Remark,ErrFlg AS ErrFlg,ErrMassages AS ErrMassages,InputUser AS InputUser,InputDate AS InputDate,LineNbr AS LineNbr
      FROM ConsignmentTransferInit
      <dynamic prepend="WHERE">
        <isNotNull prepend="AND" property="Id">ID=#Id#</isNotNull>
        <isNotNull prepend="AND" property="DealerCodeTo">DealerCodeTo=#DealerCodeTo#</isNotNull>
        <isNotNull prepend="AND" property="DealerIdTo">DealerIdTo=#DealerIdTo#</isNotNull>
        <isNotNull prepend="AND" property="DealerCodeFrom">DealerCodeFrom=#DealerCodeFrom#</isNotNull>
        <isNotNull prepend="AND" property="DealerIdFrom">DealerIdFrom=#DealerIdFrom#</isNotNull>
        <isNotNull prepend="AND" property="ProductLineName">ProductLineName=#ProductLineName#</isNotNull>
        <isNotNull prepend="AND" property="ProductLineId">ProductLineId=#ProductLineId#</isNotNull>
        <isNotNull prepend="AND" property="Upn">Upn=#Upn#</isNotNull>
        <isNotNull prepend="AND" property="Qty">Qty=#Qty#</isNotNull>
        <isNotNull prepend="AND" property="ContractNo">ContractNo=#ContractNo#</isNotNull>
        <isNotNull prepend="AND" property="ContractId">ContractId=#ContractId#</isNotNull>
        <isNotNull prepend="AND" property="HospitalCode">HospitalCode=#HospitalCode#</isNotNull>
        <isNotNull prepend="AND" property="HospitalName">HospitalName=#HospitalName#</isNotNull>
        <isNotNull prepend="AND" property="HospitalId">HospitalId=#HospitalId#</isNotNull>
        <isNotNull prepend="AND" property="Remark">Remark=#Remark#</isNotNull>
        <isNotNull prepend="AND" property="ErrFlg">ErrFlg=#ErrFlg#</isNotNull>
        <isNotNull prepend="AND" property="ErrMassages">ErrMassages=#ErrMassages#</isNotNull>
        <isNotNull prepend="AND" property="InputUser">InputUser=#InputUser#</isNotNull>
        <isNotNull prepend="AND" property="InputDate">InputDate=#InputDate#</isNotNull>
        <isNotNull prepend="AND" property="LineNbr">LineNbr=#LineNbr#</isNotNull>
      </dynamic>
    </select>
    <insert id="InsertConsignmentTransferInit" parameterClass="ConsignmentTransferInit">
      INSERT INTO ConsignmentTransferInit
      (ID,DealerCodeTo,DealerIdTo,DealerCodeFrom,DealerIdFrom,ProductLineName,ProductLineId,Upn,Qty,ContractNo,ContractId,HospitalCode,HospitalName,HospitalId,Remark,ErrFlg,ErrMassages,InputUser,InputDate,LineNbr)
      VALUES(#Id#,#DealerCodeTo#,#DealerIdTo#,#DealerCodeFrom#,#DealerIdFrom#,#ProductLineName#,#ProductLineId#,#Upn#,#Qty#,#ContractNo#,#ContractId#,#HospitalCode#,#HospitalName#,#HospitalId#,#Remark#,#ErrFlg#,#ErrMassages#,#InputUser#,#InputDate:DateTime:1/1/0001 12:00:00 AM#,#LineNbr#)
    </insert>
    <update id="UpdateConsignmentTransferInit" parameterClass="ConsignmentTransferInit">
      UPDATE ConsignmentTransferInit
      SET ID=#Id#,DealerCodeTo=#DealerCodeTo#,DealerIdTo=#DealerIdTo#,DealerCodeFrom=#DealerCodeFrom#,DealerIdFrom=#DealerIdFrom#,ProductLineName=#ProductLineName#,ProductLineId=#ProductLineId#,Upn=#Upn#,Qty=#Qty#,ContractNo=#ContractNo#,ContractId=#ContractId#,HospitalCode=#HospitalCode#,HospitalName=#HospitalName#,HospitalId=#HospitalId#,Remark=#Remark#,ErrFlg=#ErrFlg#,ErrMassages=#ErrMassages#,InputUser=#InputUser#,InputDate=#InputDate#,LineNbr=#LineNbr#
      WHERE ID = #Id#
    </update>
    <delete id="DeleteConsignmentTransferInit" parameterClass="string">
      DELETE FROM ConsignmentTransferInit
      WHERE ID = #value#
    </delete>

    <select id="SelectConsignmentTransferInitList"  parameterClass="string" resultClass="System.Data.DataSet">
      SELECT ID AS Id
      ,DealerCodeTo AS DealerCodeTo,DealerIdTo AS DealerIdTo,C.DMA_ChineseName AS DealerNameTo
      ,DealerCodeFrom AS DealerCodeFrom,DealerIdFrom AS DealerIdFrom,B.DMA_ChineseName AS DealerNameFrom
      ,A.ProductLineId AS ProductLineId,A.ProductLineName AS ProductLineName
      ,Upn AS Upn,Qty AS Qty,ContractNo AS ContractNo,ContractId AS ContractId
      ,HospitalCode AS HospitalCode,HospitalName AS HospitalName,HospitalId AS HospitalId,Remark AS Remark
      ,ErrFlg AS ErrFlg,ErrMassages AS ErrMassages,InputUser AS InputUser,InputDate AS InputDate,LineNbr AS LineNbr
      ,ROW_NUMBER ()OVER (ORDER BY ErrFlg desc)   AS row_number
      FROM ConsignmentTransferInit A
      LEFT JOIN DealerMaster B ON A.DealerIdFrom=B.DMA_ID
      LEFT JOIN DealerMaster C ON C.DMA_ID=A.DealerIdTo
      WHERE InputUser=#value#
    </select>

    <delete id="DeleteConsignmentTransferInitByUser" parameterClass="string">
      DELETE FROM ConsignmentTransferInit
      WHERE InputUser = #value#
    </delete>
    
    <procedure id="GC_ConsignmentTransferInit" parameterMap="ConsignmentTransferInitParameterMap">
      Consignment.GC_ConsignmentTransferInit
    </procedure>
    
  </statements>
</sqlMap>
