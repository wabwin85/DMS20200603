<?xml version="1.0" encoding="utf-8" ?>
<sqlMap namespace="DpStatementChangeLogMap" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://ibatis.apache.org/mapping">
  <alias>
    <typeAlias alias="DpStatementChangeLog" assembly="DMS.Model.dll" type="DMS.Model.DpStatementChangeLog" />
  </alias>
  <resultMaps>
    <resultMap id="DpStatementChangeLogResult" class="DpStatementChangeLog">
      <result property="Id" column="STL_ID" type="Guid" dbType="uniqueidentifier"/>
      <result property="StdId" column="STL_STD_ID" type="Guid" dbType="uniqueidentifier"/>
      <result property="ValueOld" column="STL_ValueOld" type="string" dbType="nvarchar"/>
      <result property="ValueNew" column="STL_ValueNew" type="string" dbType="nvarchar"/>
      <result property="Remark" column="STL_Remark" type="string" dbType="nvarchar"/>
      <result property="CreateUser" column="STL_CreateUser" type="Guid" dbType="uniqueidentifier"/>
      <result property="CreateDate" column="STL_CreateDate" type="DateTime" dbType="datetime"/>
    </resultMap>
  </resultMaps>
  <statements>

    <select id="SelectDpStatementChangeLog" parameterClass="string" resultClass="DpStatementChangeLog">
      SELECT STL_ID AS Id,STL_STD_ID AS StdId,STL_ValueOld AS ValueOld,STL_ValueNew AS ValueNew,STL_Remark AS Remark,STL_CreateUser AS CreateUser,STL_CreateDate AS CreateDate
      FROM DPStatementChangeLog
      <dynamic prepend="WHERE">
        <isParameterPresent>
          STL_ID = #value#
        </isParameterPresent>
      </dynamic>
    </select>
    <select id="SelectByFilterDpStatementChangeLog" parameterClass="DpStatementChangeLog" resultClass="DpStatementChangeLog">
      SELECT STL_ID AS Id,STL_STD_ID AS StdId,STL_ValueOld AS ValueOld,STL_ValueNew AS ValueNew,STL_Remark AS Remark,STL_CreateUser AS CreateUser,STL_CreateDate AS CreateDate
      FROM DPStatementChangeLog
      <dynamic prepend="WHERE">
        <isNotNull prepend="AND" property="Id">STL_ID=#Id#</isNotNull>
        <isNotNull prepend="AND" property="StdId">STL_STD_ID=#StdId#</isNotNull>
        <isNotNull prepend="AND" property="ValueOld">STL_ValueOld=#ValueOld#</isNotNull>
        <isNotNull prepend="AND" property="ValueNew">STL_ValueNew=#ValueNew#</isNotNull>
        <isNotNull prepend="AND" property="Remark">STL_Remark=#Remark#</isNotNull>
      </dynamic>
    </select>
    <insert id="InsertDpStatementChangeLog" parameterClass="DpStatementChangeLog">
      INSERT INTO DPStatementChangeLog
      (STL_ID,STL_STD_ID,STL_ValueOld,STL_ValueNew,STL_Remark,STL_CreateUser,STL_CreateDate)
      VALUES(#Id#,#StdId#,#ValueOld#,#ValueNew#,#Remark#,#CreateUser#,#CreateDate:DateTime:1/1/0001 12:00:00 AM#)
    </insert>
    <update id="UpdateDpStatementChangeLog" parameterClass="DpStatementChangeLog">
      UPDATE DPStatementChangeLog
      SET STL_ID=#Id#,STL_STD_ID=#StdId#,STL_ValueOld=#ValueOld#,STL_ValueNew=#ValueNew#,STL_Remark=#Remark#
      WHERE STL_ID = #Id#
    </update>
    <delete id="DeleteDpStatementChangeLog" parameterClass="string">
      DELETE FROM DPStatementChangeLog
      WHERE STL_ID = #value#
    </delete>

    <!--added by bozhenfei on 20151207-->
    <select id="SelectDealerFinanceStatementDetailChangeLogByKey" parameterClass="System.Collections.Hashtable" resultClass="DpStatementChangeLog">
      SELECT STL_ID AS Id,STL_STD_ID AS StdId,STL_ValueOld AS ValueOld,STL_ValueNew AS ValueNew,STL_Remark AS Remark,IDENTITY_NAME AS CreateUser,STL_CreateDate AS CreateDate,
      ROW_NUMBER () OVER (ORDER BY STL_CreateDate DESC) AS row_number
      FROM DPStatementChangeLog
      INNER JOIN DPStatementDetail ON STL_STD_ID = STD_ID
      LEFT OUTER JOIN Lafite_IDENTITY ON STL_CreateUser = Id
      WHERE STD_STH_ID = #HeaderId#
      AND STD_Key = #Key#
    </select>
    <!--end-->
  </statements>
</sqlMap>
