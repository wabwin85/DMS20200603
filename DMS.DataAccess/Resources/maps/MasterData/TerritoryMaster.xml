<?xml version="1.0" encoding="utf-8" ?>
<sqlMap namespace="TerritoryMasterMap" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://ibatis.apache.org/mapping">
    <alias>
        <typeAlias alias="TerritoryMaster" assembly="DMS.Model.dll" type="DMS.Model.TerritoryMaster" />
    </alias>
    <resultMaps>
        <resultMap id="TerritoryMasterResult" class="TerritoryMaster">
            <result property="Id" column="TEM_ID" type="Guid" dbType="uniqueidentifier"/>
            <result property="Code" column="TEM_Code" type="string" dbType="nvarchar"/>
            <result property="Name" column="TEM_Name" type="string" dbType="nvarchar"/>
            <result property="Description" column="TEM_Description" type="string" dbType="nvarchar"/>
            <result property="ParentId" column="TEM_Parent_ID" type="Guid" dbType="uniqueidentifier"/>
            <result property="DeleteFlag" column="TEM_DeleteFlag" type="bool" dbType="bit"/>
            <result property="CreateDate" column="TEM_CreateDate" type="DateTime" dbType="datetime"/>
            <result property="UpdateDate" column="TEM_UpdateDate" type="DateTime" dbType="datetime"/>
        </resultMap>
    </resultMaps>
    <statements>

        <select id="SelectTerritoryMaster" parameterClass="string" resultClass="TerritoryMaster">
            SELECT TEM_ID AS Id,TEM_Code AS Code,TEM_Name AS Name,TEM_Description AS Description,TEM_Parent_ID AS ParentId,TEM_DeleteFlag AS DeleteFlag,TEM_CreateDate AS CreateDate,TEM_UpdateDate AS UpdateDate
            FROM TerritoryMaster
            <dynamic prepend="WHERE">
                <isParameterPresent>
                    TEM_ID = #value#
                </isParameterPresent>
            </dynamic>
        </select>
        <select id="SelectByFilterTerritoryMaster" parameterClass="TerritoryMaster" resultClass="TerritoryMaster">
            SELECT TEM_ID AS Id,TEM_Code AS Code,TEM_Name AS Name,TEM_Description AS Description,TEM_Parent_ID AS ParentId,TEM_DeleteFlag AS DeleteFlag,TEM_CreateDate AS CreateDate,TEM_UpdateDate AS UpdateDate
            FROM TerritoryMaster
            <dynamic prepend="WHERE">
                <isNotNull prepend="AND" property="Id">TEM_ID=#Id#</isNotNull>
                <isNotNull prepend="AND" property="Code">TEM_Code=#Code#</isNotNull>
                <isNotNull prepend="AND" property="Name">TEM_Name=#Name#</isNotNull>
                <isNotNull prepend="AND" property="Description">TEM_Description=#Description#</isNotNull>
                <isNotNull prepend="AND" property="ParentId">TEM_Parent_ID=#ParentId#</isNotNull>
                <isNotNull prepend="AND" property="DeleteFlag">TEM_DeleteFlag=#DeleteFlag#</isNotNull>
                <isNotNull prepend="AND" property="UpdateDate">TEM_UpdateDate=#UpdateDate#</isNotNull>
            </dynamic>
        </select>
        <insert id="InsertTerritoryMaster" parameterClass="TerritoryMaster">
            INSERT INTO TerritoryMaster
            (TEM_ID,TEM_Code,TEM_Name,TEM_Description,TEM_Parent_ID,TEM_DeleteFlag,TEM_CreateDate,TEM_UpdateDate)
            VALUES(#Id#,#Code#,#Name#,#Description#,#ParentId#,#DeleteFlag#,#CreateDate:DateTime:1/1/0001 12:00:00 AM#,#UpdateDate:DateTime:1/1/0001 12:00:00 AM#)
        </insert>
        <update id="UpdateTerritoryMaster" parameterClass="TerritoryMaster">
            UPDATE TerritoryMaster
            SET TEM_ID=#Id#,TEM_Code=#Code#,TEM_Name=#Name#,TEM_Description=#Description#,TEM_Parent_ID=#ParentId#,TEM_DeleteFlag=#DeleteFlag#,TEM_UpdateDate=#UpdateDate#
            WHERE TEM_ID = #Id#
        </update>
        <delete id="DeleteTerritoryMaster" parameterClass="string">
            DELETE FROM TerritoryMaster
            WHERE TEM_ID = #value#
        </delete>
        <!--added by bozhenfei on 20110215-->
        <!---->
        <select id="QueryTerritoryMasterForPurchaseOrder" parameterClass="TerritoryMaster" resultClass="TerritoryMaster">
            SELECT
            TEM_ID AS Id,
            TEM_Code AS Code,
            TEM_Name AS Name,
            TEM_Description AS Description
            FROM TerritoryMaster
            INNER JOIN DealerTerritory ON DealerTerritory.DT_TEM_ID = TerritoryMaster.TEM_ID
            INNER JOIN TerritoryHierarchy ON TerritoryHierarchy.TH_ID = TerritoryMaster.TEM_Parent_ID
            WHERE TerritoryMaster.TEM_DeleteFlag = 0
            AND DealerTerritory.DT_DeleteFlag = 0
            AND TerritoryHierarchy.TH_DeleteFlag = 0
            AND TerritoryHierarchy.TH_Level = 'Province'
            <isNotNull prepend="AND" property="DealerId">DealerTerritory.DT_DMA_ID=#DealerId#</isNotNull>
            <isNotNull prepend="AND" property="ProductLineId">TerritoryHierarchy.TH_BUM_ID=#ProductLineId#</isNotNull>
        </select>
        <!--end-->
    </statements>
</sqlMap>
