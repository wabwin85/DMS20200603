<?xml version="1.0" encoding="utf-8" ?>
<sqlMap namespace="IssuesListMap" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://ibatis.apache.org/mapping">
  <alias>
    <typeAlias alias="IssuesList" assembly="DMS.Model.dll" type="DMS.Model.IssuesList" />
  </alias>
  <resultMaps>
    <resultMap id="IssuesListResult" class="IssuesList">
      <result property="Id" column="ISL_ID" type="Guid" dbType="Guid"/>
      <result property="Question" column="ISL_Question" type="string" dbType="varchar"/>
      <result property="Answer" column="ISL_Answer" type="string" dbType="varchar"/>
      <result property="SortNo" column="ISL_SortNo" type="int" dbType="Int"/>
      <result property="DeleteFlag" column="ISL_DeleteFlag" type="bool" dbType="bool"/>
    </resultMap>
  </resultMaps>
  <statements>

    <select id="SelectIssuesList" parameterClass="string" resultClass="IssuesList">
      SELECT ISL_ID AS Id,ISL_Question AS Question,ISL_Answer AS Answer,ISL_SortNo AS SortNo,ISL_DeleteFlag AS DeleteFlag
      FROM IssuesList
      <dynamic prepend="WHERE">
        <isParameterPresent>
          ISL_ID = #value#
        </isParameterPresent>
      </dynamic>
    </select>
    <select id="SelectByFilterIssuesList" parameterClass="IssuesList" resultClass="IssuesList">
      SELECT ISL_ID AS Id,ISL_Question AS Question,ISL_Answer AS Answer,ISL_SortNo AS SortNo,ISL_DeleteFlag AS DeleteFlag
      FROM IssuesList
      <dynamic prepend="WHERE">
        <isNotNull prepend="AND" property="Id">ISL_ID=#Id#</isNotNull>
        <isNotNull prepend="AND" property="Question">ISL_Question=#Question#</isNotNull>
        <isNotNull prepend="AND" property="Answer">ISL_Answer=#Answer#</isNotNull>
        <isNotNull prepend="AND" property="SortNo">ISL_SortNo=#SortNo#</isNotNull>
        <isNotNull prepend="AND" property="DeleteFlag">ISL_DeleteFlag=#DeleteFlag#</isNotNull>
      </dynamic>
    </select>
    <insert id="InsertIssuesList" parameterClass="IssuesList">
      INSERT INTO IssuesList
      (ISL_ID,ISL_Question,ISL_Answer,ISL_SortNo,ISL_DeleteFlag)
      VALUES(#Id#,#Question#,#Answer#,#SortNo#,#DeleteFlag#)
    </insert>
    <update id="UpdateIssuesList" parameterClass="IssuesList">
      UPDATE IssuesList
      SET ISL_ID=#Id#,ISL_Question=#Question#,ISL_Answer=#Answer#,ISL_SortNo=#SortNo#,ISL_DeleteFlag=#DeleteFlag#
      WHERE ISL_ID = #Id#
    </update>
    <delete id="DeleteIssuesList" parameterClass="string">
      DELETE FROM IssuesList
      WHERE ISL_ID = #value#
    </delete>

    <!--added by songyuqi on 20100607-->
    <select id="QuerySelectByFilterIssuesList" parameterClass="System.Collections.Hashtable" resultClass="IssuesList">
      SELECT ISL_ID AS Id,ISL_Question AS Question,ISL_Answer AS Answer,ISL_SortNo AS SortNo,ISL_DeleteFlag AS DeleteFlag
      ,row_number() OVER (ORDER BY ISL_SortNo ASC) AS row_number
      FROM IssuesList
      <dynamic prepend="WHERE">
        <isNotNull prepend="AND" property="Id">ISL_ID=#Id#</isNotNull>
        <isNotNull prepend="AND" property="Question">ISL_Question=#Question#</isNotNull>
        <isNotNull prepend="AND" property="Answer">ISL_Answer=#Answer#</isNotNull>
        <isNotNull prepend="AND" property="SortNo">ISL_SortNo=#SortNo#</isNotNull>
        <isNotNull prepend="AND" property="DeleteFlag">ISL_DeleteFlag=#DeleteFlag#</isNotNull>
        <isNotNull prepend="AND" property="KeyWords">(ISL_Question like '%$KeyWords$%' OR ISL_Answer like '%$KeyWords$%')</isNotNull>
      </dynamic>
    </select>
    <select id="QueryTopTenIssuesListOnLogin" parameterClass="System.Collections.Hashtable" resultClass="IssuesList">
      SELECT ISL_ID AS Id,ISL_Question AS Question,ISL_Answer AS Answer,ISL_SortNo AS SortNo,ISL_DeleteFlag AS DeleteFlag
      FROM IssuesList
      <dynamic prepend="WHERE">
        <isNotNull prepend="AND" property="DeleteFlag">ISL_DeleteFlag=#DeleteFlag#</isNotNull>
      </dynamic>
      ORDER BY ISL_SortNo DESC
    </select>
    <select id="SelectByFilterIssuesListBySortNo" parameterClass="string" resultClass="IssuesList">
      SELECT ISL_ID AS Id,ISL_Question AS Question,ISL_Answer AS Answer,ISL_SortNo AS SortNo,ISL_DeleteFlag AS DeleteFlag
      ,row_number() OVER (ORDER BY ISL_SortNo ASC) AS row_number
      FROM IssuesList WHERE ISL_SortNo=#value# AND ISL_DeleteFlag=0
    </select>

    <select id="SelectByFilterIssuesListMaxSortNo" parameterClass="string" resultClass="IssuesList">
      SELECT MAX(ISL_SortNo) MaxSortNo
      FROM IssuesList WHERE ISL_DeleteFlag=0
    </select>

    <delete id="FakeDeleteIssuesList" parameterClass="string">
      UPDATE IssuesList SET
      ISL_DeleteFlag=1
      WHERE ISL_ID = #value#
    </delete>

    <!--end-->
  </statements>
</sqlMap>
