<sqlMap namespace="InvGoodsCfgInit" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" >
	<alias>
		<typeAlias alias="InvGoodsCfgInit" assembly="DMS.Model.dll" type="DMS.Model.InvGoodsCfgInit" />
	</alias>
	<parameterMaps>
		<parameterMap id="InvGoodsCfgInitParameterMap" class="System.Collections.Hashtable" >
			<parameter property="UserId" column="UserId" />
			<parameter property="ImportType" column="ImportType" />
			<parameter property="IsValid" column="IsValid" direction="Output" /> 
		</parameterMap>
	</parameterMaps>
	<statements>
		<delete id="DeleteInvGoodsCfgImportByUser" parameterClass="string">
			DELETE FROM InvGoodsCfgInit
			WHERE ImportUser = #value#
		</delete>
		<select id="QueryInvGoodsCfgImport"  parameterClass="System.Collections.Hashtable" resultClass="System.Data.DataSet">
			SELECT ID,SubCompanyName,BrandName, ProductLine,ProductNameCN,InvType,ImportUser,QryCFN,ErrorMsg,IsError,ImportDate,
			ROW_NUMBER() OVER(ORDER BY ImportDate DESC) AS [row_number]
			FROM InvGoodsCfgInit
			<dynamic prepend="WHERE">
				<isNotNull prepend="AND" property="ImportUser">ImportUser=#UserId#</isNotNull>
			</dynamic>
		</select>
		<select id="QueryInvGoodsCfgImportCheck" parameterClass="string" resultClass="System.Data.DataSet">
			SELECT A.ID,A.SubCompanyName,A.BrandName, A.ProductLine,A.ProductNameCN,A.InvType,A.ImportUser,A.QryCFN,A.ErrorMsg,A.IsError,A.ImportDate, B.Id as InvGoodsCfgId,
			ROW_NUMBER() OVER(ORDER BY A.ImportDate DESC) AS [row_number] FROM InvGoodsCfgInit A inner join InvGoodsConfig B on A.SubCompanyName=B.SubCompanyName
			AND A.BrandName=B.BrandName AND A.ProductLine = B.ProductLine AND A.QryCFN=B.QryCFN AND A.InvType = B.InvType
			WHERE A.ImportUser=#UserId#
		</select>
		<update id="UpdateExistInvGoodsCfgImportStatus" parameterClass="System.Collections.Hashtable">
			UPDATE InvGoodsCfgInit SET ErrorMsg = '该行数据已导入，请检查', isError= 1
			<dynamic prepend="WHERE">
				<isNotNull prepend="AND" property="Id">Id=#Id#</isNotNull>
				<isNotNull prepend="AND" property="ImportUser">ImportUser=#ImportUser#</isNotNull>
				<isNotNull prepend="AND" property="SubCompanyName">SubCompanyName=#SubCompanyName#</isNotNull>
				<isNotNull prepend="AND" property="BrandName">BrandName=#BrandName#</isNotNull>
				<isNotNull prepend="AND" property="ProductLine">ProductLine=#ProductLine#</isNotNull>
				<isNotNull prepend="AND" property="ProductNameCN">ProductNameCN=#ProductNameCN#</isNotNull>
				<isNotNull prepend="AND" property="QryCFN">QryCFN=#QryCFN#</isNotNull>
			</dynamic>
		</update>
		<delete id="DelInvGoodsCfgById" parameterClass="string">
			Delete from InvGoodsConfig where Id = #value#
		</delete>
		<procedure id="GC_InitializeInvGoodsInitImport" parameterMap="InvGoodsCfgInitParameterMap">
			dbo.GC_InitializeInvGoodsInitImport
		</procedure>
		
	</statements>
</sqlMap>
