<?xml version="1.0" encoding="utf-8" ?>
<sqlMap namespace="EnterpriseMasterMap" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://ibatis.apache.org/mapping">
  <alias>
    <typeAlias alias="EnterpriseMaster" assembly="DMS.Signature.dll" type="DMS.Signature.Model.EnterpriseMaster" />
  </alias>
  <resultMaps>
    <resultMap id="EnterpriseMasterResult" class="EnterpriseMaster">
      <result property="Id" column="EM_ID" type="Guid" dbType="uniqueidentifier"/>
      <result property="DmaId" column="EM_DMA_ID" type="Guid" dbType="uniqueidentifier"/>
      <result property="ParentDmaId" column="EM_Parent_DMA_ID" type="Guid" dbType="uniqueidentifier"/>
      <result property="DealerName" column="EM_DealerName" type="string" dbType="nvarchar"/>
      <result property="AccountUid" column="EM_AccountUid" type="string" dbType="nvarchar"/>
      <result property="Phone" column="EM_Phone" type="string" dbType="nvarchar"/>
      <result property="Email" column="EM_Email" type="string" dbType="nvarchar"/>
      <result property="Name" column="EM_Name" type="string" dbType="nvarchar"/>
      <result property="OrganType" column="EM_OrganType" type="int" dbType="int"/>
      <result property="RegType" column="EM_RegType" type="string" dbType="nvarchar"/>
      <result property="OrganCode" column="EM_OrganCode" type="string" dbType="nvarchar"/>
      <result property="UserType" column="EM_UserType" type="int" dbType="int"/>
      <result property="LegalName" column="EM_LegalName" type="string" dbType="nvarchar"/>
      <result property="LegalIdNo" column="EM_LegalIdNo" type="string" dbType="nvarchar"/>
      <result property="LegalArea" column="EM_LegalArea" type="int" dbType="int"/>
      <result property="AgentName" column="EM_AgentName" type="string" dbType="nvarchar"/>
      <result property="AgentIdNo" column="EM_AgentIdNo" type="string" dbType="nvarchar"/>
      <result property="Address" column="EM_Address" type="string" dbType="nvarchar"/>
      <result property="Scope" column="EM_Scope" type="string" dbType="nvarchar"/>
      <result property="Status" column="EM_Status" type="string" dbType="nvarchar"/>
      <result property="CreateUser" column="EM_CreateUser" type="Guid" dbType="uniqueidentifier"/>
      <result property="CreateUserName" column="EM_CreateUserName" type="string" dbType="nvarchar"/>
      <result property="CreateDate" column="EM_CreateDate" type="DateTime" dbType="datetime"/>
      <result property="UpdateUser" column="EM_UpdateUser" type="Guid" dbType="uniqueidentifier"/>
      <result property="UpdateUserName" column="EM_UpdateUserName" type="string" dbType="nvarchar"/>
      <result property="UpdateDate" column="EM_UpdateDate" type="DateTime" dbType="datetime"/>
    </resultMap>
  </resultMaps>
  <statements>

    <select id="SelectEnterpriseMaster" parameterClass="string" resultClass="EnterpriseMaster">
      SELECT EM_ID AS Id,EM_DMA_ID AS DmaId,EM_Parent_DMA_ID AS ParentDmaId,EM_DealerName AS DealerName,EM_AccountUid AS AccountUid,EM_Phone AS Phone,EM_Email AS Email,EM_Name AS Name,EM_OrganType AS OrganType,EM_RegType AS RegType,EM_OrganCode AS OrganCode,EM_UserType AS UserType,EM_LegalName AS LegalName,EM_LegalIdNo AS LegalIdNo,EM_LegalArea AS LegalArea,EM_AgentName AS AgentName,EM_AgentIdNo AS AgentIdNo,EM_Address AS Address,EM_Scope AS Scope,EM_Status AS Status,EM_CreateUser AS CreateUser,EM_CreateUserName AS CreateUserName,EM_CreateDate AS CreateDate,EM_UpdateUser AS UpdateUser,EM_UpdateUserName AS UpdateUserName,EM_UpdateDate AS UpdateDate
      FROM ESign.EnterpriseMaster
      <dynamic prepend="WHERE">
        <isParameterPresent>
          EM_ID = #value#
        </isParameterPresent>
      </dynamic>
    </select>
    <select id="SelectByFilterEnterpriseMaster" parameterClass="EnterpriseMaster" resultClass="EnterpriseMaster">
      SELECT EM_ID AS Id,EM_DMA_ID AS DmaId,EM_Parent_DMA_ID AS ParentDmaId,EM_DealerName AS DealerName,EM_AccountUid AS AccountUid,EM_Phone AS Phone,EM_Email AS Email,EM_Name AS Name,EM_OrganType AS OrganType,EM_RegType AS RegType,EM_OrganCode AS OrganCode,EM_UserType AS UserType,EM_LegalName AS LegalName,EM_LegalIdNo AS LegalIdNo,EM_LegalArea AS LegalArea,EM_AgentName AS AgentName,EM_AgentIdNo AS AgentIdNo,EM_Address AS Address,EM_Scope AS Scope,EM_Status AS Status,EM_CreateUser AS CreateUser,EM_CreateUserName AS CreateUserName,EM_CreateDate AS CreateDate,EM_UpdateUser AS UpdateUser,EM_UpdateUserName AS UpdateUserName,EM_UpdateDate AS UpdateDate
      FROM ESign.EnterpriseMaster
      <dynamic prepend="WHERE">
        <isNotNull prepend="AND" property="Id">EM_ID=#Id#</isNotNull>
        <isNotNull prepend="AND" property="DmaId">EM_DMA_ID=#DmaId#</isNotNull>
        <isNotNull prepend="AND" property="AccountUid">EM_AccountUid=#AccountUid#</isNotNull>
        <isNotNull prepend="AND" property="Phone">EM_Phone=#Phone#</isNotNull>
        <isNotNull prepend="AND" property="Email">EM_Email=#Email#</isNotNull>
        <isNotNull prepend="AND" property="Name">EM_Name=#Name#</isNotNull>
        <isNotNull prepend="AND" property="OrganType">EM_OrganType=#OrganType#</isNotNull>
        <isNotNull prepend="AND" property="RegType">EM_RegType=#RegType#</isNotNull>
        <isNotNull prepend="AND" property="OrganCode">EM_OrganCode=#OrganCode#</isNotNull>
        <isNotNull prepend="AND" property="UserType">EM_UserType=#UserType#</isNotNull>
        <isNotNull prepend="AND" property="LegalName">EM_LegalName=#LegalName#</isNotNull>
        <isNotNull prepend="AND" property="LegalIdNo">EM_LegalIdNo=#LegalIdNo#</isNotNull>
        <isNotNull prepend="AND" property="LegalArea">EM_LegalArea=#LegalArea#</isNotNull>
        <isNotNull prepend="AND" property="AgentName">EM_AgentName=#AgentName#</isNotNull>
        <isNotNull prepend="AND" property="AgentIdNo">EM_AgentIdNo=#AgentIdNo#</isNotNull>
        <isNotNull prepend="AND" property="Address">EM_Address=#Address#</isNotNull>
        <isNotNull prepend="AND" property="Scope">EM_Scope=#Scope#</isNotNull>
        <isNotNull prepend="AND" property="Status">EM_Status=#Status#</isNotNull>
        <isNotNull prepend="AND" property="CreateUserName">EM_CreateUserName=#CreateUserName#</isNotNull>
        <isNotNull prepend="AND" property="UpdateUser">EM_UpdateUser=#UpdateUser#</isNotNull>
        <isNotNull prepend="AND" property="UpdateUserName">EM_UpdateUserName=#UpdateUserName#</isNotNull>
        <isNotNull prepend="AND" property="UpdateDate">EM_UpdateDate=#UpdateDate#</isNotNull>
      </dynamic>
    </select>
    <insert id="InsertEnterpriseMaster" parameterClass="EnterpriseMaster">
      
      IF (#Status# != 'ERROR')
      BEGIN
        IF (EXISTS (SELECT 1 FROM ESign.EnterpriseMaster WITH ( UPDLOCK, HOLDLOCK )
        WHERE EM_DMA_ID = #DmaId# AND EM_Status = 'NORMAL' ))
        BEGIN
        UPDATE ESign.EnterpriseMaster SET EM_Status='MODIFY',EM_UpdateUser=#UpdateUser#,EM_UpdateUserName=#UpdateUserName#,EM_UpdateDate=#UpdateDate#
        WHERE EM_DMA_ID = #DmaId# AND EM_Status = 'NORMAL'
        END
      END
      
      INSERT INTO ESign.EnterpriseMaster
      (EM_ID,EM_DMA_ID,EM_Parent_DMA_ID,EM_DealerName,EM_AccountUid,EM_Phone,EM_Email,EM_Name,EM_OrganType,EM_RegType,EM_OrganCode,EM_UserType,EM_LegalName,EM_LegalIdNo,EM_LegalArea,EM_AgentName,EM_AgentIdNo,EM_Address,EM_Scope,EM_Status,EM_CreateUser,EM_CreateUserName,EM_CreateDate,EM_UpdateUser,EM_UpdateUserName,EM_UpdateDate)
      VALUES(#Id#,#DmaId#,#ParentDmaId#,#DealerName#,#AccountUid#,#Phone#,#Email#,#Name#,#OrganType#,#RegType#,#OrganCode#,#UserType#,#LegalName#,#LegalIdNo#,#LegalArea#,#AgentName#,#AgentIdNo#,#Address#,#Scope#,#Status#,#CreateUser#,#CreateUserName#,#CreateDate:DateTime:1/1/0001 12:00:00 AM#,#UpdateUser#,#UpdateUserName#,#UpdateDate:DateTime:1/1/0001 12:00:00 AM#)
    </insert>
    <update id="UpdateEnterpriseMaster" parameterClass="EnterpriseMaster">
      UPDATE ESign.EnterpriseMaster
      SET EM_ID=#Id#,EM_DMA_ID=#DmaId#,EM_Parent_DMA_ID=#ParentDmaId#,EM_DealerName=#DealerName#,EM_AccountUid=#AccountUid#,EM_Phone=#Phone#,EM_Email=#Email#,EM_Name=#Name#,EM_OrganType=#OrganType#,EM_RegType=#RegType#,EM_OrganCode=#OrganCode#,EM_UserType=#UserType#,EM_LegalName=#LegalName#,EM_LegalIdNo=#LegalIdNo#,EM_LegalArea=#LegalArea#,EM_AgentName=#AgentName#,EM_AgentIdNo=#AgentIdNo#,EM_Address=#Address#,EM_Scope=#Scope#,EM_Status=#Status#,EM_CreateUserName=#CreateUserName#,EM_UpdateUser=#UpdateUser#,EM_UpdateUserName=#UpdateUserName#,EM_UpdateDate=#UpdateDate#
      WHERE EM_ID = #Id#
    </update>
    <delete id="DeleteEnterpriseMaster" parameterClass="string">
      DELETE FROM ESign.EnterpriseMaster
      WHERE EM_ID = #value#
    </delete>

    <select id="QueryEnterpriseMasterByDealerId" parameterClass="string" resultClass="System.Data.DataSet">
      SELECT EM_ID AS Id,DMA_ID AS DmaId,#ParentDealerId# AS ParentDmaId,ISNULL(EM_DealerName,DMA_ChineseShortName) AS DealerName,EM_AccountUid AS AccountUid,EM_Phone AS Phone,EM_Email AS Email,ISNULL(EM_Name,DMA_ChineseName) AS Name,EM_OrganType AS OrganType,EM_RegType AS RegType,EM_OrganCode AS OrganCode,EM_UserType AS UserType,EM_LegalName AS LegalName,EM_LegalIdNo AS LegalIdNo,EM_LegalArea AS LegalArea,EM_AgentName AS AgentName,EM_AgentIdNo AS AgentIdNo,EM_Address AS Address,EM_Scope AS Scope,EM_Status AS Status,EM_CreateUser AS CreateUser,EM_CreateUserName AS CreateUserName,EM_CreateDate AS CreateDate,EM_UpdateUser AS UpdateUser,EM_UpdateUserName AS UpdateUserName,EM_UpdateDate AS UpdateDate
      ,DMA_ChineseName AS DealerName,DMA_SAP_Code AS SapCode,ELM_AccountUid AS LegalAccountUid,ES_Seal AS Seal,ELS_Seal AS LegalSeal,EM_Phone AS Phone
      FROM DealerMaster
      LEFT JOIN ESign.EnterpriseMaster ON DMA_ID = EM_DMA_ID AND EM_Status = 'NORMAL'
      LEFT JOIN ESign.EnterpriseLegalMaster ON DMA_ID = ELM_DMA_ID AND ELM_Status = 'NORMAL'
      LEFT JOIN ESign.EnterpriseSeal ON DMA_ID = ES_DMA_ID AND ES_IsActive = 1
      LEFT JOIN ESign.EnterpriseLegalSeal ON DMA_ID = ELS_DMA_ID AND ELS_IsActive = 1
      WHERE DMA_ID = #DealerId#
    </select>
    
    <select id="QueryEnterpriseMasterByAccountUid" parameterClass="string" resultClass="EnterpriseMaster">
      SELECT EM_ID AS Id,DMA_ID AS DmaId,EM_Parent_DMA_ID AS ParentDmaId,ISNULL(EM_DealerName,DMA_ChineseShortName) AS DealerName,EM_AccountUid AS AccountUid,EM_Phone AS Phone,EM_Email AS Email,ISNULL(EM_Name,DMA_ChineseName) AS Name,EM_OrganType AS OrganType,EM_RegType AS RegType,EM_OrganCode AS OrganCode,EM_UserType AS UserType,EM_LegalName AS LegalName,EM_LegalIdNo AS LegalIdNo,EM_LegalArea AS LegalArea,EM_AgentName AS AgentName,EM_AgentIdNo AS AgentIdNo,EM_Address AS Address,EM_Scope AS Scope,EM_Status AS Status,EM_CreateUser AS CreateUser,EM_CreateUserName AS CreateUserName,EM_CreateDate AS CreateDate,EM_UpdateUser AS UpdateUser,EM_UpdateUserName AS UpdateUserName,EM_UpdateDate AS UpdateDate
      ,DMA_ChineseName AS DealerName,DMA_SAP_Code AS SapCode
      FROM DealerMaster
      INNER JOIN ESign.EnterpriseMaster ON DMA_ID = EM_DMA_ID AND EM_Status = 'NORMAL'
      WHERE EM_AccountUid = #AccountUid#
    </select>
  </statements>
</sqlMap>
